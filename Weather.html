<!DOCTYPE html>
<html>
    <head>

        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
      
        <title>Weather Dashboard</title>
      
        <!-- Boostrap Stylesheet -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
        <!-- Customized Stylings -->   
<style>
      .navbar-nav {   
            color:white;
            background-color:black;
            font-size:40px;
            font-weight: bolder;
            text-align: center;
        }

      .sidebar-left {
          display:table-cell;
          float:none;
        }

      .content-right {
          display:table-cell; 
          float:none;
        }

      .card h5 {
          font-weight:bold;
        }

</style>
</head>

<body>

<nav class="nav navbar-nav">
      Weather Dashboard
  </nav>

  <div class="row">   
    <div id="sidebar-left" class="col-2 col-lg-2">
      <!-- Input/Search Functionality -->
      Search for a City:
      <input type="text" class="WeatherSearch col-8">
      <button onclick=InputSearch() style="background-color:#0099CC; color:white; font-size:24px"> <i class="fa fa-search"></i></button>
      <br></br>
      <!-- Search History and OnClick Functionalities -->
      <div class="card" style="border:2px light; height:35px"> <a class = "Hist1" href=javascript:InputHist1()></a> </div>
      <div class="card" style="border:2px light; height:35px"> <a class = "Hist2" href=javascript:InputHist2()></a> </div>
      <div class="card" style="border:2px light; height:35px"> <a class = "Hist3" href=javascript:InputHist3()></a> </div>
      <div class="card" style="border:2px light; height:35px"> <a class = "Hist4" href=javascript:InputHist4()></a> </div>
      <div class="card" style="border:2px light; height:35px"> <a class = "Hist5" href=javascript:InputHist5()></a> </div>
      <div class="card" style="border:2px light; height:35px"> <a class = "Hist6" href=javascript:InputHist6()></a> </div>
      <div class="card" style="border:2px light; height:35px"> <a class = "Hist7" href=javascript:InputHist7()></a> </div>
      <div class="card" style="border:2px light; height:35px"> <a class = "Hist8" href=javascript:InputHist8()></a> </div>
      <div class="card" style="border:2px light; height:35px"> <a class = "Hist9" href=javascript:InputHist9()></a> </div>
      <div class="card" style="border:2px light; height:35px"> <a class = "Hist10" href=javascript:InputHist10()></a> </div>
   </div>

    <div id="content-right" class="col-lg-10 container" >
      <!-- Main Weather Information Card -->
      <div class="card">      
          <!-- Title -->
          <div><h1 class="City-Title" style="display:inline-block"></h1><img class="today-icon" style="display:inline-block"></div>
          <!-- Weather Information -->
          <h5 class="Temperature"></h5>
          <h5 class="Humidity"></h5>
          <h5 class="WSpeed"></h5>  
          <div><h5 class="UVIndex" style="display:inline-block"></h5>  
          <h5 class="UVIndexValue" style="display:inline-block"></h5></div>
        </div>

      <!-- Weather Forecast Information Card -->
        <h1>
          5 Day Forecast
        </h1>
        <div class="d-flex flex-row">

      <!-- Day 1 --> 
        <div class="card col-2 col-lg-2" style="background-color: #0099CC; color:white;">
            <h5 class="OneDayF"><a></a></h5>
            <img class="OneDayIcon">
            <h6 class ="OneDayTemp"></h6>
            <h6 class ="OneDayHumid"></h6>
          </div>
      <!-- Day 2 -->  
        <div class="card col-2 col-lg-2" style="background-color: #0099CC; color:white; margin-left: 20px;">     
            <h5 class="TwoDayF"></h5>
            <img class="TwoDayIcon">
            <h6 class ="TwoDayTemp"></h6>
            <h6 class ="TwoDayHumid"></h6>
          </div>
      <!-- Day 3 -->
        <div class="card col-2 col-lg-2" style="background-color: #0099CC; color:white; margin-left: 20px">
            <h5 class="ThreeDayF"></h5>
            <img class="ThreeDayIcon">
            <h6 class ="ThreeDayTemp"></h6>
            <h6 class ="ThreeDayHumid"></h6>
          </div>
      <!-- Day 4 -->   
        <div class="card col-2 col-lg-2" style="background-color: #0099CC; color:white; margin-left: 20px">     
            <h5 class="FourDayF"></h5>
            <img class="FourDayIcon">
            <h6 class ="FourDayTemp"></h6>
            <h6 class ="FourDayHumid"></h6>
          </div>
      <!-- Day 5 -->     
        <div class="card col-2 col-lg-2" style="background-color: #0099CC; color:white; margin-left: 20px">     
            <h5 class="FiveDayF"></h5>
            <img class="FiveDayIcon">
            <h6 class ="FiveDayTemp"></h6>
            <h6 class ="FiveDayHumid"></h6>
          </div>
        </div>
      </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <script src="https://use.fontawesome.com/releases/v5.12.1/js/all.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript">
      // This is our API key
      var APIKey = "166a433c57516f51dfab1f7edaed8413";
   
      // Set weather to be most recent weather in local storage. Default (empty localStorage) is Hoboken
      var place = "Hoboken"
            if (localStorage.getItem("History10") !== null)
            place=localStorage.getItem("History10")
            else if (localStorage.getItem("History9") !== null)
            place=localStorage.getItem("History9")
            else if (localStorage.getItem("History8") !== null)
            place=localStorage.getItem("History8")
            else if (localStorage.getItem("History7") !== null)
            place=localStorage.getItem("History7")
            else if (localStorage.getItem("History6") !== null)
            place=localStorage.getItem("History6")
            else if (localStorage.getItem("History5") !== null)
            place=localStorage.getItem("History5")
            else if (localStorage.getItem("History4") !== null)
            place=localStorage.getItem("History4")
            else if (localStorage.getItem("History3") !== null)
            place=localStorage.getItem("History3")
            else if (localStorage.getItem("History2") !== null)
            place=localStorage.getItem("History2")
            else if (localStorage.getItem("History1") !== null)
            place=localStorage.getItem("History1")
            else {place="Hoboken"};

      // Trigger and run AJAX functions
      SiteScript()
      function SiteScript () {      
      var queryURL = "https://api.openweathermap.org/data/2.5/weather?" +
        "q=" + place + "&appid=" + APIKey;
      // Primary Current Weather AJAX call (This also includes the UV Index Div Call)
      $.ajax({
        url: queryURL,
        method: "GET"
      })
      // Populate Divs with values in the AJAX response
      .then(function(response) {
      // Date
          var todaysdate= moment().format("l");
      // City Name Div 
          $(".City-Title").text(response.name + " " + todaysdate);
      // City Weather Icon 
          var iconcode = response.weather[0].icon;
          var iconurl = "http://openweathermap.org/img/w/" + iconcode + ".png";
          $(".today-icon").attr('src', iconurl);
      // Temperature Calculation (Kelvin to Fahrenheit)
          KelvinTemp = response.main.temp;
          FahrTemp = (KelvinTemp - 273) * (9/5) + 32;
          $(".Temperature").text("Temperature: " + Math.round(FahrTemp));
      // Humidity
          $(".Humidity").text("Humidity: " + response.main.humidity);
      // Wind Speed
          $(".WSpeed").text("Wind Speed: " + response.wind.speed);

      // UV Index Query & AJAX Pull
          var queryURL3 = "https://api.openweathermap.org/data/2.5/uvi?&appid="+ APIKey + "&lat=" +
          response.coord.lat + "&lon=" + response.coord.lon;
        $.ajax({
        url: queryURL3,
        method: "GET"
      })
      // UV Index AJAX Pull
        .then(function(response3) {
      // UV Index Text
          $(".UVIndex").text("UV Index: ");
      // Conditional Formatting for Index Text
          $(".UVIndexValue").text(response3.value);
          if (response3.value<3) {
          $(".UVIndexValue").css('background-color','green')
          }
          if (response3.value>3 && response3.value<7){
          $(".UVIndexValue").css('background-color','yellow')
          }
          else {$(".UVIndexValue").css('background-color','red')}
        })})

      // Forecast AJAX Pull
      var queryURL2 = "https://api.openweathermap.org/data/2.5/forecast?" +
        "q=" + place + "&appid=" + APIKey;
        $.ajax({
        url: queryURL2,
        method: "GET"
      })
      // Pull Data from Forecast Response
        .then(function(response2) {
      // Date Each Card
        $(".OneDayF").text(moment().add(1,'days').format("l"));
        $(".TwoDayF").text(moment().add(2,'days').format("l")); 
        $(".ThreeDayF").text(moment().add(3,'days').format("l"));  
        $(".FourDayF").text(moment().add(4,'days').format("l"));  
        $(".FiveDayF").text(moment().add(5,'days').format("l"));
      // Record Temperature Forecast on Each Card
        KelvinTemp1 = response2.list[6].main.temp;
        FahrTemp1 = (KelvinTemp1 - 273) * (9/5) + 32;
        $(".OneDayTemp").text("Temp: " + Math.round(FahrTemp1));
        KelvinTemp2 = response2.list[14].main.temp;
        FahrTemp2 = (KelvinTemp2 - 273) * (9/5) + 32;
        $(".TwoDayTemp").text("Temp: " + Math.round(FahrTemp2));
        KelvinTemp3 = response2.list[22].main.temp;
        FahrTemp3 = (KelvinTemp3 - 273) * (9/5) + 32;
        $(".ThreeDayTemp").text("Temp: " + Math.round(FahrTemp3));
        KelvinTemp4 = response2.list[30].main.temp;
        FahrTemp4 = (KelvinTemp4 - 273) * (9/5) + 32;
        $(".FourDayTemp").text("Temp: " + Math.round(FahrTemp4));
        KelvinTemp5 = response2.list[38].main.temp;
        FahrTemp5 = (KelvinTemp5 - 273) * (9/5) + 32;
        $(".FiveDayTemp").text("Temp: " + Math.round(FahrTemp5));
      // Record Humidity Forecast on Card
        $(".OneDayHumid").text("Humidity: " + response2.list[6].main.humidity);
        $(".TwoDayHumid").text("Humidity: " + response2.list[14].main.humidity);
        $(".ThreeDayHumid").text("Humidity: " + response2.list[22].main.humidity);
        $(".FourDayHumid").text("Humidity: " + response2.list[30].main.humidity);
        $(".FiveDayHumid").text("Humidity: " + response2.list[38].main.humidity);
      // Place Weather Icon on Each Card
        var iconcode1 = response2.list[6].weather[0].icon;
        var iconurl1 = "http://openweathermap.org/img/w/" + iconcode1 + ".png";
        $(".OneDayIcon").attr('src', iconurl1);
        var iconcode2 = response2.list[14].weather[0].icon;
        var iconurl2 = "http://openweathermap.org/img/w/" + iconcode2 + ".png";
        $(".TwoDayIcon").attr('src', iconurl2);
        var iconcode3 = response2.list[22].weather[0].icon;
        var iconurl3 = "http://openweathermap.org/img/w/" + iconcode3 + ".png";
        $(".ThreeDayIcon").attr('src', iconurl3);
        var iconcode4 = response2.list[30].weather[0].icon;
        var iconurl4 = "http://openweathermap.org/img/w/" + iconcode4 + ".png";
        $(".FourDayIcon").attr('src', iconurl4);
        var iconcode5 = response2.list[38].weather[0].icon;
        var iconurl5 = "http://openweathermap.org/img/w/" + iconcode5 + ".png";
        $(".FiveDayIcon").attr('src', iconurl5);
        });
        //Set History Divs at the End of Every Lookup
        SetHistory();
        //End of Primary Script
        }

        // Search Value in Input Field, Add to Search History
        function InputSearch() {
            place = $(".WeatherSearch").val();
            $(".WeatherSearch").val("");
            SiteScript();
            if (localStorage.getItem("History1") === null)
            {localStorage.setItem("History1", place);
            SiteScript();}
            else if (localStorage.getItem("History2") === null)
            {localStorage.setItem("History2", place);
            SiteScript();}
            else if (localStorage.getItem("History3") === null)
            {localStorage.setItem("History3", place);
            SiteScript();}
            else if (localStorage.getItem("History4") === null)
            {localStorage.setItem("History4", place);
            SiteScript();}
            else if (localStorage.getItem("History5") === null)
            {localStorage.setItem("History5", place);
            SiteScript();}
            else if (localStorage.getItem("History6") === null)
            {localStorage.setItem("History6", place);
            SiteScript();}
            else if (localStorage.getItem("History7") === null)
            {localStorage.setItem("History7", place);
            SiteScript();}
            else if (localStorage.getItem("History8") === null)
            {localStorage.setItem("History8", place);
            SiteScript();}
            else if (localStorage.getItem("History9") === null)
            {localStorage.setItem("History9", place);
            SiteScript();}
            else {localStorage.setItem("History10", place);
            SiteScript();}
        }
      //Search History Buttons
      function InputHist1() {
            place = localStorage.getItem("History1");
            SiteScript();}
      function InputHist2() {
            place = localStorage.getItem("History2");
            SiteScript();}  
      function InputHist3() {
            place = localStorage.getItem("History3");
            SiteScript();}  
      function InputHist4() {
            place = localStorage.getItem("History4");
            SiteScript();}  
      function InputHist5() {
            place = localStorage.getItem("History5");
            SiteScript();}  
      function InputHist6() {
            place = localStorage.getItem("History6");
            SiteScript();}  
      function InputHist7() {
            place = localStorage.getItem("History7");
            SiteScript();}  
      function InputHist8() {
            place = localStorage.getItem("History8");
            SiteScript();}  
      function InputHist9() {
            place = localStorage.getItem("History9");
            SiteScript();}  
      function InputHist10() {
            place = localStorage.getItem("History10");
            SiteScript();}  

      //Assign localStorage Values to History Divs Sidebar
      function SetHistory()
      {     $(".Hist1").text(localStorage.getItem("History1"));
            $(".Hist2").text(localStorage.getItem("History2"));
            $(".Hist3").text(localStorage.getItem("History3"));
            $(".Hist4").text(localStorage.getItem("History4"));
            $(".Hist5").text(localStorage.getItem("History5"));
            $(".Hist6").text(localStorage.getItem("History6"));
            $(".Hist7").text(localStorage.getItem("History7"));
            $(".Hist8").text(localStorage.getItem("History8"));
            $(".Hist9").text(localStorage.getItem("History9"));
            $(".Hist10").text(localStorage.getItem("History10"));
      }
      //Set Up History Containers on Page Open
      SetHistory()
  </script>

</body>

</html>